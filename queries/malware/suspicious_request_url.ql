/**
 * @name suspicious_request_url
 * @description Query
 * @kind problem
 * @problem.severity error
 * @security-severity 9.0
 * @precision low
 * @id npm/sample_4
 * @tags security
 *       request
 *       wreck
 */

import javascript


from ClientRequest request, string request_URL
where request.getUrl().mayHaveStringValue(request_URL)
  and request_URL.matches("%supplychainattack%")
select request, "Suspicious URL: " + request_URL


////////// Utilities //////////


class WreckRequest extends ClientRequest::Range, DataFlow::CallNode {

    // CharPred
    WreckRequest() {
        this = DataFlow::moduleMember("wreck", "get").getACall()
    }

    // TODO: The following methods aren't suitable for an actual query...

    override DataFlow::Node getUrl() { this.getAnArgument() = result }
    override DataFlow::Node getHost() { this.getAnArgument() = result }
    override DataFlow::Node getADataNode() { this.getAnArgument() = result }

}
